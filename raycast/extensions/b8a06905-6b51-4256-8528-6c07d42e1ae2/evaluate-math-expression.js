"use strict";var bt=Object.create;var W=Object.defineProperty;var kt=Object.getOwnPropertyDescriptor;var Pt=Object.getOwnPropertyNames;var mt=Object.getPrototypeOf,It=Object.prototype.hasOwnProperty;var Ct=(p,o)=>()=>(o||p((o={exports:{}}).exports,o),o.exports),St=(p,o)=>{for(var x in o)W(p,x,{get:o[x],enumerable:!0})},xe=(p,o,x,T)=>{if(o&&typeof o=="object"||typeof o=="function")for(let b of Pt(o))!It.call(p,b)&&b!==x&&W(p,b,{get:()=>o[b],enumerable:!(T=kt(o,b))||T.enumerable});return p};var Nt=(p,o,x)=>(x=p!=null?bt(mt(p)):{},xe(o||!p||!p.__esModule?W(x,"default",{value:p,enumerable:!0}):x,p)),Rt=p=>xe(W({},"__esModule",{value:!0}),p);var Me=Ct((Y,Ee)=>{(function(p,o){typeof Y=="object"&&typeof Ee<"u"?o(Y):typeof define=="function"&&define.amd?define(["exports"],o):(p=p||self,o(p.exprEval={}))})(Y,function(p){"use strict";var o="INUMBER",x="IOP1",T="IOP2",b="IOP3",k="IVAR",S="IVARNAME",F="IFUNCALL",_="IFUNDEF",M="IEXPR",K="IEXPREVAL",N="IMEMBER",j="IENDSTATEMENT",L="IARRAY";function l(e,t){this.type=e,this.value=t??0}l.prototype.toString=function(){switch(this.type){case o:case x:case T:case b:case k:case S:case j:return this.value;case F:return"CALL "+this.value;case _:return"DEF "+this.value;case L:return"ARRAY "+this.value;case N:return"."+this.value;default:return"Invalid Instruction"}};function V(e){return new l(x,e)}function P(e){return new l(T,e)}function ie(e){return new l(b,e)}function H(e,t,r,s,n){for(var a=[],i=[],u,f,w,y,E=0;E<e.length;E++){var h=e[E],d=h.type;if(d===o||d===S)Array.isArray(h.value)?a.push.apply(a,H(h.value.map(function($){return new l(o,$)}).concat(new l(L,h.value.length)),t,r,s,n)):a.push(h);else if(d===k&&n.hasOwnProperty(h.value))h=new l(o,n[h.value]),a.push(h);else if(d===T&&a.length>1)f=a.pop(),u=a.pop(),y=r[h.value],h=new l(o,y(u.value,f.value)),a.push(h);else if(d===b&&a.length>2)w=a.pop(),f=a.pop(),u=a.pop(),h.value==="?"?a.push(u.value?f.value:w.value):(y=s[h.value],h=new l(o,y(u.value,f.value,w.value)),a.push(h));else if(d===x&&a.length>0)u=a.pop(),y=t[h.value],h=new l(o,y(u.value)),a.push(h);else if(d===M){for(;a.length>0;)i.push(a.shift());i.push(new l(M,H(h.value,t,r,s,n)))}else if(d===N&&a.length>0)u=a.pop(),a.push(new l(o,u.value[h.value]));else{for(;a.length>0;)i.push(a.shift());i.push(h)}}for(;a.length>0;)i.push(a.shift());return i}function ae(e,t,r){for(var s=[],n=0;n<e.length;n++){var a=e[n],i=a.type;if(i===k&&a.value===t)for(var u=0;u<r.tokens.length;u++){var f=r.tokens[u],w;f.type===x?w=V(f.value):f.type===T?w=P(f.value):f.type===b?w=ie(f.value):w=new l(f.type,f.value),s.push(w)}else i===M?s.push(new l(M,ae(a.value,t,r))):s.push(a)}return s}function R(e,t,r){var s=[],n,a,i,u,f,w;if(z(e))return m(e,r);for(var y=e.length,E=0;E<y;E++){var h=e[E],d=h.type;if(d===o||d===S)s.push(h.value);else if(d===T)a=s.pop(),n=s.pop(),h.value==="and"?s.push(n?!!R(a,t,r):!1):h.value==="or"?s.push(n?!0:!!R(a,t,r)):h.value==="="?(u=t.binaryOps[h.value],s.push(u(n,R(a,t,r),r))):(u=t.binaryOps[h.value],s.push(u(m(n,r),m(a,r))));else if(d===b)i=s.pop(),a=s.pop(),n=s.pop(),h.value==="?"?s.push(R(n?a:i,t,r)):(u=t.ternaryOps[h.value],s.push(u(m(n,r),m(a,r),m(i,r))));else if(d===k)if(h.value in t.functions)s.push(t.functions[h.value]);else if(h.value in t.unaryOps&&t.parser.isOperatorEnabled(h.value))s.push(t.unaryOps[h.value]);else{var $=r[h.value];if($!==void 0)s.push($);else throw new Error("undefined variable: "+h.value)}else if(d===x)n=s.pop(),u=t.unaryOps[h.value],s.push(u(m(n,r)));else if(d===F){for(w=h.value,f=[];w-- >0;)f.unshift(m(s.pop(),r));if(u=s.pop(),u.apply&&u.call)s.push(u.apply(void 0,f));else throw new Error(u+" is not a function")}else if(d===_)s.push(function(){for(var At=s.pop(),se=[],Ot=h.value;Ot-- >0;)se.unshift(s.pop());var ge=s.pop(),ne=function(){for(var de=Object.assign({},r),X=0,Tt=se.length;X<Tt;X++)de[se[X]]=arguments[X];return R(At,t,de)};return Object.defineProperty(ne,"name",{value:ge,writable:!1}),r[ge]=ne,ne}());else if(d===M)s.push(ke(h,t));else if(d===K)s.push(h);else if(d===N)n=s.pop(),s.push(n[h.value]);else if(d===j)s.pop();else if(d===L){for(w=h.value,f=[];w-- >0;)f.unshift(s.pop());s.push(f)}else throw new Error("invalid Expression")}if(s.length>1)throw new Error("invalid Expression (parity)");return s[0]===0?0:m(s[0],r)}function ke(e,t,r){return z(e)?e:{type:K,value:function(s){return R(e.value,t,s)}}}function z(e){return e&&e.type===K}function m(e,t){return z(e)?e.value(t):e}function Q(e,t){for(var r=[],s,n,a,i,u,f,w=0;w<e.length;w++){var y=e[w],E=y.type;if(E===o)typeof y.value=="number"&&y.value<0?r.push("("+y.value+")"):Array.isArray(y.value)?r.push("["+y.value.map(oe).join(", ")+"]"):r.push(oe(y.value));else if(E===T)n=r.pop(),s=r.pop(),i=y.value,t?i==="^"?r.push("Math.pow("+s+", "+n+")"):i==="and"?r.push("(!!"+s+" && !!"+n+")"):i==="or"?r.push("(!!"+s+" || !!"+n+")"):i==="||"?r.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+s+"),("+n+")))"):i==="=="?r.push("("+s+" === "+n+")"):i==="!="?r.push("("+s+" !== "+n+")"):i==="["?r.push(s+"[("+n+") | 0]"):r.push("("+s+" "+i+" "+n+")"):i==="["?r.push(s+"["+n+"]"):r.push("("+s+" "+i+" "+n+")");else if(E===b)if(a=r.pop(),n=r.pop(),s=r.pop(),i=y.value,i==="?")r.push("("+s+" ? "+n+" : "+a+")");else throw new Error("invalid Expression");else if(E===k||E===S)r.push(y.value);else if(E===x)s=r.pop(),i=y.value,i==="-"||i==="+"?r.push("("+i+s+")"):t?i==="not"?r.push("(!"+s+")"):i==="!"?r.push("fac("+s+")"):r.push(i+"("+s+")"):i==="!"?r.push("("+s+"!)"):r.push("("+i+" "+s+")");else if(E===F){for(f=y.value,u=[];f-- >0;)u.unshift(r.pop());i=r.pop(),r.push(i+"("+u.join(", ")+")")}else if(E===_){for(n=r.pop(),f=y.value,u=[];f-- >0;)u.unshift(r.pop());s=r.pop(),t?r.push("("+s+" = function("+u.join(", ")+") { return "+n+" })"):r.push("("+s+"("+u.join(", ")+") = "+n+")")}else if(E===N)s=r.pop(),r.push(s+"."+y.value);else if(E===L){for(f=y.value,u=[];f-- >0;)u.unshift(r.pop());r.push("["+u.join(", ")+"]")}else if(E===M)r.push("("+Q(y.value,t)+")");else if(E!==j)throw new Error("invalid Expression")}return r.length>1&&(t?r=[r.join(",")]:r=[r.join(";")]),String(r[0])}function oe(e){return typeof e=="string"?JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):e}function D(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return!0;return!1}function Z(e,t,r){r=r||{};for(var s=!!r.withMembers,n=null,a=0;a<e.length;a++){var i=e[a];i.type===k||i.type===S?!s&&!D(t,i.value)?t.push(i.value):(n!==null&&(D(t,n)||t.push(n)),n=i.value):i.type===N&&s&&n!==null?n+="."+i.value:i.type===M?Z(i.value,t,r):n!==null&&(D(t,n)||t.push(n),n=null)}n!==null&&!D(t,n)&&t.push(n)}function A(e,t){this.tokens=e,this.parser=t,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.functions=t.functions}A.prototype.simplify=function(e){return e=e||{},new A(H(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,e),this.parser)},A.prototype.substitute=function(e,t){return t instanceof A||(t=this.parser.parse(String(t))),new A(ae(this.tokens,e,t),this.parser)},A.prototype.evaluate=function(e){return e=e||{},R(this.tokens,this,e)},A.prototype.toString=function(){return Q(this.tokens,!1)},A.prototype.symbols=function(e){e=e||{};var t=[];return Z(this.tokens,t,e),t},A.prototype.variables=function(e){e=e||{};var t=[];Z(this.tokens,t,e);var r=this.functions;return t.filter(function(s){return!(s in r)})},A.prototype.toJSFunction=function(e,t){var r=this,s=new Function(e,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+Q(this.simplify(t).tokens,!0)+"; }");return function(){return s.apply(r,arguments)}};var q="TEOF",c="TOP",B="TNUMBER",he="TSTRING",I="TPAREN",U="TBRACKET",G="TCOMMA",J="TNAME",ee="TSEMICOLON";function ue(e,t,r){this.type=e,this.value=t,this.index=r}ue.prototype.toString=function(){return this.type+": "+this.value};function g(e,t){this.pos=0,this.current=null,this.unaryOps=e.unaryOps,this.binaryOps=e.binaryOps,this.ternaryOps=e.ternaryOps,this.consts=e.consts,this.expression=t,this.savedPosition=0,this.savedCurrent=null,this.options=e.options,this.parser=e}g.prototype.newToken=function(e,t,r){return new ue(e,t,r??this.pos)},g.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current},g.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent},g.prototype.next=function(){if(this.pos>=this.expression.length)return this.newToken(q,"EOF");if(this.isWhitespace()||this.isComment())return this.next();if(this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName())return this.current;this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},g.prototype.isString=function(){var e=!1,t=this.pos,r=this.expression.charAt(t);if(r==="'"||r==='"')for(var s=this.expression.indexOf(r,t+1);s>=0&&this.pos<this.expression.length;){if(this.pos=s+1,this.expression.charAt(s-1)!=="\\"){var n=this.expression.substring(t+1,s);this.current=this.newToken(he,this.unescape(n),t),e=!0;break}s=this.expression.indexOf(r,s+1)}return e},g.prototype.isParen=function(){var e=this.expression.charAt(this.pos);return e==="("||e===")"?(this.current=this.newToken(I,e),this.pos++,!0):!1},g.prototype.isBracket=function(){var e=this.expression.charAt(this.pos);return(e==="["||e==="]")&&this.isOperatorEnabled("[")?(this.current=this.newToken(U,e),this.pos++,!0):!1},g.prototype.isComma=function(){var e=this.expression.charAt(this.pos);return e===","?(this.current=this.newToken(G,","),this.pos++,!0):!1},g.prototype.isSemicolon=function(){var e=this.expression.charAt(this.pos);return e===";"?(this.current=this.newToken(ee,";"),this.pos++,!0):!1},g.prototype.isConst=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||r!=="_"&&r!=="."&&(r<"0"||r>"9")))break}if(t>e){var s=this.expression.substring(e,t);if(s in this.consts)return this.current=this.newToken(B,this.consts[s]),this.pos+=s.length,!0}return!1},g.prototype.isNamedOp=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||r!=="_"&&(r<"0"||r>"9")))break}if(t>e){var s=this.expression.substring(e,t);if(this.isOperatorEnabled(s)&&(s in this.binaryOps||s in this.unaryOps||s in this.ternaryOps))return this.current=this.newToken(c,s),this.pos+=s.length,!0}return!1},g.prototype.isName=function(){for(var e=this.pos,t=e,r=!1;t<this.expression.length;t++){var s=this.expression.charAt(t);if(s.toUpperCase()===s.toLowerCase()){if(t===this.pos&&(s==="$"||s==="_")){s==="_"&&(r=!0);continue}else if(t===this.pos||!r||s!=="_"&&(s<"0"||s>"9"))break}else r=!0}if(r){var n=this.expression.substring(e,t);return this.current=this.newToken(J,n),this.pos+=n.length,!0}return!1},g.prototype.isWhitespace=function(){for(var e=!1,t=this.expression.charAt(this.pos);(t===" "||t==="	"||t===`
`||t==="\r")&&(e=!0,this.pos++,!(this.pos>=this.expression.length));)t=this.expression.charAt(this.pos);return e};var Pe=/^[0-9a-f]{4}$/i;g.prototype.unescape=function(e){var t=e.indexOf("\\");if(t<0)return e;for(var r=e.substring(0,t);t>=0;){var s=e.charAt(++t);switch(s){case"'":r+="'";break;case'"':r+='"';break;case"\\":r+="\\";break;case"/":r+="/";break;case"b":r+="\b";break;case"f":r+="\f";break;case"n":r+=`
`;break;case"r":r+="\r";break;case"t":r+="	";break;case"u":var n=e.substring(t+1,t+5);Pe.test(n)||this.parseError("Illegal escape sequence: \\u"+n),r+=String.fromCharCode(parseInt(n,16)),t+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+s+'"')}++t;var a=e.indexOf("\\",t);r+=e.substring(t,a<0?e.length:a),t=a}return r},g.prototype.isComment=function(){var e=this.expression.charAt(this.pos);return e==="/"&&this.expression.charAt(this.pos+1)==="*"?(this.pos=this.expression.indexOf("*/",this.pos)+2,this.pos===1&&(this.pos=this.expression.length),!0):!1},g.prototype.isRadixInteger=function(){var e=this.pos;if(e>=this.expression.length-2||this.expression.charAt(e)!=="0")return!1;++e;var t,r;if(this.expression.charAt(e)==="x")t=16,r=/^[0-9a-f]$/i,++e;else if(this.expression.charAt(e)==="b")t=2,r=/^[01]$/i,++e;else return!1;for(var s=!1,n=e;e<this.expression.length;){var a=this.expression.charAt(e);if(r.test(a))e++,s=!0;else break}return s&&(this.current=this.newToken(B,parseInt(this.expression.substring(n,e),t)),this.pos=e),s},g.prototype.isNumber=function(){for(var e=!1,t=this.pos,r=t,s=t,n=!1,a=!1,i;t<this.expression.length&&(i=this.expression.charAt(t),i>="0"&&i<="9"||!n&&i===".");)i==="."?n=!0:a=!0,t++,e=a;if(e&&(s=t),i==="e"||i==="E"){t++;for(var u=!0,f=!1;t<this.expression.length;){if(i=this.expression.charAt(t),u&&(i==="+"||i==="-"))u=!1;else if(i>="0"&&i<="9")f=!0,u=!1;else break;t++}f||(t=s)}return e?(this.current=this.newToken(B,parseFloat(this.expression.substring(r,t))),this.pos=t):this.pos=s,e},g.prototype.isOperator=function(){var e=this.pos,t=this.expression.charAt(this.pos);if(t==="+"||t==="-"||t==="*"||t==="/"||t==="%"||t==="^"||t==="?"||t===":"||t===".")this.current=this.newToken(c,t);else if(t==="\u2219"||t==="\u2022")this.current=this.newToken(c,"*");else if(t===">")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(c,">="),this.pos++):this.current=this.newToken(c,">");else if(t==="<")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(c,"<="),this.pos++):this.current=this.newToken(c,"<");else if(t==="|")if(this.expression.charAt(this.pos+1)==="|")this.current=this.newToken(c,"||"),this.pos++;else return!1;else if(t==="=")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(c,"=="),this.pos++):this.current=this.newToken(c,t);else if(t==="!")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(c,"!="),this.pos++):this.current=this.newToken(c,t);else return!1;return this.pos++,this.isOperatorEnabled(this.current.value)?!0:(this.pos=e,!1)},g.prototype.isOperatorEnabled=function(e){return this.parser.isOperatorEnabled(e)},g.prototype.getCoordinates=function(){var e=0,t,r=-1;do e++,t=this.pos-r,r=this.expression.indexOf(`
`,r+1);while(r>=0&&r<this.pos);return{line:e,column:t}},g.prototype.parseError=function(e){var t=this.getCoordinates();throw new Error("parse error ["+t.line+":"+t.column+"]: "+e)};function v(e,t,r){this.parser=e,this.tokens=t,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=r.allowMemberAccess!==!1}v.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},v.prototype.tokenMatches=function(e,t){return typeof t>"u"?!0:Array.isArray(t)?D(t,e.value):typeof t=="function"?t(e):e.value===t},v.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},v.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},v.prototype.accept=function(e,t){return this.nextToken.type===e&&this.tokenMatches(this.nextToken,t)?(this.next(),!0):!1},v.prototype.expect=function(e,t){if(!this.accept(e,t)){var r=this.tokens.getCoordinates();throw new Error("parse error ["+r.line+":"+r.column+"]: Expected "+(t||e))}},v.prototype.parseAtom=function(e){var t=this.tokens.unaryOps;function r(n){return n.value in t}if(this.accept(J)||this.accept(c,r))e.push(new l(k,this.current.value));else if(this.accept(B))e.push(new l(o,this.current.value));else if(this.accept(he))e.push(new l(o,this.current.value));else if(this.accept(I,"("))this.parseExpression(e),this.expect(I,")");else if(this.accept(U,"["))if(this.accept(U,"]"))e.push(new l(L,0));else{var s=this.parseArrayList(e);e.push(new l(L,s))}else throw new Error("unexpected "+this.nextToken)},v.prototype.parseExpression=function(e){var t=[];this.parseUntilEndStatement(e,t)||(this.parseVariableAssignmentExpression(t),!this.parseUntilEndStatement(e,t)&&this.pushExpression(e,t))},v.prototype.pushExpression=function(e,t){for(var r=0,s=t.length;r<s;r++)e.push(t[r])},v.prototype.parseUntilEndStatement=function(e,t){return this.accept(ee)?(this.nextToken&&this.nextToken.type!==q&&!(this.nextToken.type===I&&this.nextToken.value===")")&&t.push(new l(j)),this.nextToken.type!==q&&this.parseExpression(t),e.push(new l(M,t)),!0):!1},v.prototype.parseArrayList=function(e){for(var t=0;!this.accept(U,"]");)for(this.parseExpression(e),++t;this.accept(G);)this.parseExpression(e),++t;return t},v.prototype.parseVariableAssignmentExpression=function(e){for(this.parseConditionalExpression(e);this.accept(c,"=");){var t=e.pop(),r=[],s=e.length-1;if(t.type===F){if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var n=0,a=t.value+1;n<a;n++){var i=s-n;e[i].type===k&&(e[i]=new l(S,e[i].value))}this.parseVariableAssignmentExpression(r),e.push(new l(M,r)),e.push(new l(_,t.value));continue}if(t.type!==k&&t.type!==N)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(r),e.push(new l(S,t.value)),e.push(new l(M,r)),e.push(P("="))}},v.prototype.parseConditionalExpression=function(e){for(this.parseOrExpression(e);this.accept(c,"?");){var t=[],r=[];this.parseConditionalExpression(t),this.expect(c,":"),this.parseConditionalExpression(r),e.push(new l(M,t)),e.push(new l(M,r)),e.push(ie("?"))}},v.prototype.parseOrExpression=function(e){for(this.parseAndExpression(e);this.accept(c,"or");){var t=[];this.parseAndExpression(t),e.push(new l(M,t)),e.push(P("or"))}},v.prototype.parseAndExpression=function(e){for(this.parseComparison(e);this.accept(c,"and");){var t=[];this.parseComparison(t),e.push(new l(M,t)),e.push(P("and"))}};var me=["==","!=","<","<=",">=",">","in"];v.prototype.parseComparison=function(e){for(this.parseAddSub(e);this.accept(c,me);){var t=this.current;this.parseAddSub(e),e.push(P(t.value))}};var Ie=["+","-","||"];v.prototype.parseAddSub=function(e){for(this.parseTerm(e);this.accept(c,Ie);){var t=this.current;this.parseTerm(e),e.push(P(t.value))}};var Ce=["*","/","%"];v.prototype.parseTerm=function(e){for(this.parseFactor(e);this.accept(c,Ce);){var t=this.current;this.parseFactor(e),e.push(P(t.value))}},v.prototype.parseFactor=function(e){var t=this.tokens.unaryOps;function r(n){return n.value in t}if(this.save(),this.accept(c,r)){if(this.current.value!=="-"&&this.current.value!=="+"){if(this.nextToken.type===I&&this.nextToken.value==="("){this.restore(),this.parseExponential(e);return}else if(this.nextToken.type===ee||this.nextToken.type===G||this.nextToken.type===q||this.nextToken.type===I&&this.nextToken.value===")"){this.restore(),this.parseAtom(e);return}}var s=this.current;this.parseFactor(e),e.push(V(s.value))}else this.parseExponential(e)},v.prototype.parseExponential=function(e){for(this.parsePostfixExpression(e);this.accept(c,"^");)this.parseFactor(e),e.push(P("^"))},v.prototype.parsePostfixExpression=function(e){for(this.parseFunctionCall(e);this.accept(c,"!");)e.push(V("!"))},v.prototype.parseFunctionCall=function(e){var t=this.tokens.unaryOps;function r(a){return a.value in t}if(this.accept(c,r)){var s=this.current;this.parseAtom(e),e.push(V(s.value))}else for(this.parseMemberExpression(e);this.accept(I,"(");)if(this.accept(I,")"))e.push(new l(F,0));else{var n=this.parseArgumentList(e);e.push(new l(F,n))}},v.prototype.parseArgumentList=function(e){for(var t=0;!this.accept(I,")");)for(this.parseExpression(e),++t;this.accept(G);)this.parseExpression(e),++t;return t},v.prototype.parseMemberExpression=function(e){for(this.parseAtom(e);this.accept(c,".")||this.accept(U,"[");){var t=this.current;if(t.value==="."){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(J),e.push(new l(N,this.current.value))}else if(t.value==="["){if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(e),this.expect(U,"]"),e.push(P("["))}else throw new Error("unexpected symbol: "+t.value)}};function Se(e,t){return Number(e)+Number(t)}function Ne(e,t){return e-t}function Re(e,t){return e*t}function Fe(e,t){return e/t}function Le(e,t){return e%t}function De(e,t){return Array.isArray(e)&&Array.isArray(t)?e.concat(t):""+e+t}function Ue(e,t){return e===t}function qe(e,t){return e!==t}function _e(e,t){return e>t}function je(e,t){return e<t}function Ve(e,t){return e>=t}function Be(e,t){return e<=t}function Ge(e,t){return!!(e&&t)}function $e(e,t){return!!(e||t)}function Xe(e,t){return D(t,e)}function We(e){return(Math.exp(e)-Math.exp(-e))/2}function Ye(e){return(Math.exp(e)+Math.exp(-e))/2}function Ke(e){return e===1/0?1:e===-1/0?-1:(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))}function He(e){return e===-1/0?e:Math.log(e+Math.sqrt(e*e+1))}function ze(e){return Math.log(e+Math.sqrt(e*e-1))}function Qe(e){return Math.log((1+e)/(1-e))/2}function pe(e){return Math.log(e)*Math.LOG10E}function Ze(e){return-e}function Je(e){return!e}function et(e){return e<0?Math.ceil(e):Math.floor(e)}function tt(e){return Math.random()*(e||1)}function fe(e){return re(e+1)}function rt(e){return isFinite(e)&&e===Math.round(e)}var st=4.7421875,te=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function re(e){var t,r;if(rt(e)){if(e<=0)return isFinite(e)?1/0:NaN;if(e>171)return 1/0;for(var s=e-2,n=e-1;s>1;)n*=s,s--;return n===0&&(n=1),n}if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*re(1-e));if(e>=171.35)return 1/0;if(e>85){var a=e*e,i=a*e,u=i*e,f=u*e;return Math.sqrt(2*Math.PI/e)*Math.pow(e/Math.E,e)*(1+1/(12*e)+1/(288*a)-139/(51840*i)-571/(2488320*u)+163879/(209018880*f)+5246819/(75246796800*f*e))}--e,r=te[0];for(var w=1;w<te.length;++w)r+=te[w]/(e+w);return t=e+st+.5,Math.sqrt(2*Math.PI)*Math.pow(t,e+.5)*Math.exp(-t)*r}function nt(e){return Array.isArray(e)?e.length:String(e).length}function le(){for(var e=0,t=0,r=0;r<arguments.length;r++){var s=Math.abs(arguments[r]),n;t<s?(n=t/s,e=e*n*n+1,t=s):s>0?(n=s/t,e+=n*n):e+=s}return t===1/0?1/0:t*Math.sqrt(e)}function ce(e,t,r){return e?t:r}function it(e,t){return typeof t>"u"||+t==0?Math.round(e):(e=+e,t=-+t,isNaN(e)||!(typeof t=="number"&&t%1===0)?NaN:(e=e.toString().split("e"),e=Math.round(+(e[0]+"e"+(e[1]?+e[1]-t:-t))),e=e.toString().split("e"),+(e[0]+"e"+(e[1]?+e[1]+t:t))))}function at(e,t,r){return r&&(r[e]=t),t}function ot(e,t){return e[t|0]}function ht(e){return arguments.length===1&&Array.isArray(e)?Math.max.apply(Math,e):Math.max.apply(Math,arguments)}function ut(e){return arguments.length===1&&Array.isArray(e)?Math.min.apply(Math,e):Math.min.apply(Math,arguments)}function pt(e,t){if(typeof e!="function")throw new Error("First argument to map is not a function");if(!Array.isArray(t))throw new Error("Second argument to map is not an array");return t.map(function(r,s){return e(r,s)})}function ft(e,t,r){if(typeof e!="function")throw new Error("First argument to fold is not a function");if(!Array.isArray(r))throw new Error("Second argument to fold is not an array");return r.reduce(function(s,n,a){return e(s,n,a)},t)}function lt(e,t){if(typeof e!="function")throw new Error("First argument to filter is not a function");if(!Array.isArray(t))throw new Error("Second argument to filter is not an array");return t.filter(function(r,s){return e(r,s)})}function ct(e,t){if(!(Array.isArray(t)||typeof t=="string"))throw new Error("Second argument to indexOf is not a string or array");return t.indexOf(e)}function vt(e,t){if(!Array.isArray(t))throw new Error("Second argument to join is not an array");return t.join(e)}function yt(e){return(e>0)-(e<0)||+e}var ve=1/3;function wt(e){return e<0?-Math.pow(-e,ve):Math.pow(e,ve)}function gt(e){return Math.exp(e)-1}function dt(e){return Math.log(1+e)}function xt(e){return Math.log(e)/Math.LN2}function C(e){this.options=e||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||We,cosh:Math.cosh||Ye,tanh:Math.tanh||Ke,asinh:Math.asinh||He,acosh:Math.acosh||ze,atanh:Math.atanh||Qe,sqrt:Math.sqrt,cbrt:Math.cbrt||wt,log:Math.log,log2:Math.log2||xt,ln:Math.log,lg:Math.log10||pe,log10:Math.log10||pe,expm1:Math.expm1||gt,log1p:Math.log1p||dt,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||et,"-":Ze,"+":Number,exp:Math.exp,not:Je,length:nt,"!":fe,sign:Math.sign||yt},this.binaryOps={"+":Se,"-":Ne,"*":Re,"/":Fe,"%":Le,"^":Math.pow,"||":De,"==":Ue,"!=":qe,">":_e,"<":je,">=":Ve,"<=":Be,and:Ge,or:$e,in:Xe,"=":at,"[":ot},this.ternaryOps={"?":ce},this.functions={random:tt,fac:fe,min:ut,max:ht,hypot:Math.hypot||le,pyt:Math.hypot||le,pow:Math.pow,atan2:Math.atan2,if:ce,gamma:re,roundTo:it,map:pt,fold:ft,filter:lt,indexOf:ct,join:vt},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}C.prototype.parse=function(e){var t=[],r=new v(this,new g(this,e),{allowMemberAccess:this.options.allowMemberAccess});return r.parseExpression(t),r.expect(q,"EOF"),new A(t,this)},C.prototype.evaluate=function(e,t){return this.parse(e).evaluate(t)};var ye=new C;C.parse=function(e){return ye.parse(e)},C.evaluate=function(e,t){return ye.parse(e).evaluate(t)};var we={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};function Et(e){return we.hasOwnProperty(e)?we[e]:e}C.prototype.isOperatorEnabled=function(e){var t=Et(e),r=this.options.operators||{};return!(t in r)||!!r[t]};var Mt={Parser:C,Expression:A};p.Expression=A,p.Parser=C,p.default=Mt,Object.defineProperty(p,"__esModule",{value:!0})})});var Ut={};St(Ut,{default:()=>be});module.exports=Rt(Ut);var O=require("@raycast/api"),Te=Nt(Me());var Ae=require("@raycast/api");function Oe(){let p=(0,Ae.getPreferenceValues)();return{...p,maxDecimals:Number(p.maxDecimals)||void 0}}function Ft(p,o){let x=new Te.Parser().evaluate(p);if(typeof x!="number")throw new Error(x);if(o.maxDecimals){let T=Math.pow(10,o.maxDecimals);x=Math.round(x*T)/T}return x}async function Lt(p,o){return o.replaceSelection&&await O.Clipboard.paste(p),o.copyToClipboard&&await O.Clipboard.copy(p),o.displayResult&&await(0,O.showToast)({style:O.Toast.Style.Success,title:`Result: ${p}`}),Promise.resolve()}async function Dt(p){return(0,O.showToast)({style:O.Toast.Style.Failure,title:`An error occurred: ${p}`})}async function be(){let p=Oe();return(0,O.closeMainWindow)().then(O.getSelectedText).then(o=>Ft(o,p)).then(o=>Lt(o,p)).catch(o=>Dt(o.message||o))}
/*! Bundled license information:

expr-eval/dist/bundle.js:
  (*!
     Based on ndef.parser, by Raphael Graf(r@undefined.ch)
     http://www.undefined.ch/mparser/index.html
  
     Ported to JavaScript and modified by Matthew Crumley (email@matthewcrumley.com, http://silentmatt.com/)
  
     You are free to use and modify this code in anyway you find useful. Please leave this comment in the code
     to acknowledge its original source. If you feel like it, I enjoy hearing about projects that use my code,
     but don't feel like you have to let me know or ask permission.
    *)
*/
